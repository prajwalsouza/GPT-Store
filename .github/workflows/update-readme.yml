name: Update README

on:
  push:
    paths:
      - 'gpts/**'

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Find newly added file in the latest commit
        id: findfile
        run: |
          # Identify the latest commit hash
          LATEST_COMMIT=$(git rev-parse HEAD)

          # Get the list of added files in the latest commit in 'gpts/' directory
          NEW_FILES=$(git show --pretty="" --name-only --diff-filter=A $LATEST_COMMIT | grep '^gpts/')

          # Debugging: print the list of new files
          echo "Newly added files in the latest commit:"
          echo "$NEW_FILES"

          # Selecting the first newly added file
          NEW_FILE=$(echo "$NEW_FILES" | head -n 1)

          if [[ ! -z "$NEW_FILE" ]]; then
            echo "::set-output name=new_file::$NEW_FILE"
          fi

      - name: Print new file content (for debugging)
        if: steps.findfile.outputs.new_file
        run: |
          NEW_FILE="${{ steps.findfile.outputs.new_file }}"
          echo "Contents of $NEW_FILE:"
          cat "$NEW_FILE"

      - name: Update README
        if: steps.findfile.outputs.new_file
        run: |
          NEW_FILE="${{ steps.findfile.outputs.new_file }}"
          CONTENT=$(cat "$NEW_FILE")
          printf "\n\n - $CONTENT" >> README.md
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git commit -m "Update README with new content from $NEW_FILE"
          git push
